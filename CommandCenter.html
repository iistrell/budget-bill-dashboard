<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mr. Budget Bill | Command Center</title>
    <style>
        :root { --blue: #002366; --orange: #FF6700; --bg: #f4f7f9; }
        body { font-family: sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        header { background: var(--blue); color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 5px solid var(--orange); border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .board { display: flex; gap: 20px; padding: 20px 0; overflow-x: auto; }
        .column { background: #e2e4e6; border-radius: 8px; min-width: 300px; padding: 10px; min-height: 80vh; }
        .column-header { padding: 10px; font-weight: bold; color: var(--blue); border-bottom: 2px solid var(--orange); margin-bottom: 10px; text-align: center; }
        .card { background: white; border-radius: 6px; padding: 15px; margin-bottom: 15px; border-left: 5px solid var(--blue); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .card h4 { margin: 0 0 5px 0; }
        .card p { font-size: 13px; color: #666; }
        .sync-btn { background: var(--orange); border: none; color: white; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>
<header style="background: #002366; color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 5px solid #FF6700;">
    <div style="font-size: 24px; font-weight: bold;">Mr. Budget Bill</div>
    <button onclick="fetchData()" style="background: #FF6700; border: none; color: white; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold;">ðŸ”„ Sync Data</button>
</header>
<header>
    <div style="font-size: 24px; font-weight: bold;">Mr. Budget<span style="color:var(--orange)">Bill</span></div>
    <button class="sync-btn" onclick="fetchData()">ðŸ”„ Refresh Board</button>
</header>

<div class="board">
    <div class="column">
        <div class="column-header">ðŸ’¡ IDEAS BUCKET</div>
        <div id="Idea"></div>
    </div>
    <div class="column">
        <div class="column-header">âœ… READY TO FILM</div>
        <div id="Ready"></div>
    </div>
    <div class="column">
        <div class="column-header">ðŸš€ LIVE / DONE</div>
        <div id="Done"></div>
    </div>
</div>

<script>
    // This is the direct ID for your Mr. Budget Bill Sheet
    const sheetID = '1wF_8A3o9NxNmRI6LbUkSbW6U1yadmOwMdTwIoMnV7Xy-_wVDl7DgrA5cl5S8VSvfjTT';
    
    // We are telling Google: "Give me the tab named Data in CSV format"
    const csvURL = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?tqx=out:csv&sheet=Data`;

    async function fetchData() {
        try {
            console.log("Attempting to sync...");
            const response = await fetch(csvURL);
            const text = await response.text();
            
            // Splits rows and removes the header
            const rows = text.split('\n').slice(1);
            
            // Clear current cards
            document.getElementById('Idea').innerHTML = '';
            document.getElementById('Ready').innerHTML = '';
            document.getElementById('Done').innerHTML = '';

            rows.forEach(row => {
                // Splits columns correctly even if there are commas in your notes
                const cols = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                if (cols.length < 3) return;

                const clean = (s) => s ? s.replace(/^"|"$/g, "").trim() : "";
                
                const title = clean(cols[1]);
                const status = clean(cols[2]); // This looks for 'Idea', 'Ready', or 'Done'
                const notes = clean(cols[4]);

                if (title && status) {
                    const card = `<div class="card"><h4>${title}</h4><p>${notes}</p></div>`;
                    const column = document.getElementById(status);
                    if (column) {
                        column.innerHTML += card;
                    }
                }
            });
            console.log("Sync successful!");
        } catch (e) {
            console.error("Sync error:", e);
        }
    }

    // Runs automatically when the page loads
    window.onload = fetchData;
</script>
    
</body>
</html>
